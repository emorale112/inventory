<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inventory Search</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label, select, input { margin: 5px 0; display: block; width: 200px; }
  button { margin-top: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  tr:nth-child(even) { background: #f9f9f9; }
  #status { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<h2>Inventory Search</h2>

<label for="query">Search Term</label>
<input id="query" type="text" placeholder="e.g. Pikachu, 123456" />

<label for="column">Column</label>
<select id="column">
  <option value="all">All Columns</option>
  <option value="box location">Box Location</option>
  <option value="item name">Item Name</option>
  <option value="upc">UPC</option>
  <option value="quantity">Quantity</option>
  <option value="received date">Received Date</option>
</select>

<label for="sheet">Sheet</label>
<select id="sheet">
  <option value="all">All Sheets</option>
</select>

<button id="searchBtn">Search</button>
<button id="clearBtn">Clear Results</button>

<div id="status"></div>
<div id="results"></div>

<script>
const SCRIPT_URL = 'https://cold-bush-cd4e.poptique1.workers.dev/'; // Replace with your Worker URL

function setStatus(text) {
  document.getElementById('status').textContent = text;
}

function clearResults() {
  document.getElementById('results').innerHTML = '';
  setStatus('Results cleared.');
}

function displayResults(results) {
  const container = document.getElementById('results');
  container.innerHTML = '';
  if (!results || results.length === 0) {
    setStatus('No matching rows found.');
    return;
  }

  const table = document.createElement('table');
  const headers = ['Box Location', 'Item Name', 'UPC', 'Quantity', 'Received Date'];

  const thead = document.createElement('thead');
  const trHead = document.createElement('tr');
  headers.forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    trHead.appendChild(th);
  });
  thead.appendChild(trHead);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  results.forEach(row => {
    const tr = document.createElement('tr');
    row.forEach(cell => {
      const td = document.createElement('td');
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);

  container.appendChild(table);
  setStatus(`Found ${results.length} matching row(s).`);
}

async function loadSheets() {
  try {
    const res = await fetch(`${SCRIPT_URL}?action=getSheetNames`);
    if (!res.ok) throw new Error('Failed to fetch sheet names');
    const data = await res.json();
    const sheetSelect = document.getElementById('sheet');
    data.sheets.forEach(name => {
      const opt = document.createElement('option');
      opt.value = name;
      opt.textContent = name;
      sheetSelect.appendChild(opt);
    });
  } catch (err) {
    setStatus('Error loading sheets: ' + err.message);
  }
}

async function runSearch() {
  const query = document.getElementById('query').value.trim();
  const column = document.getElementById('column').value;
  const sheet = document.getElementById('sheet').value;

  if (!query) {
    setStatus('Please enter a search term.');
    return;
  }

  setStatus('Searching...');
  document.getElementById('results').innerHTML = '';

  try {
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'search', query, column, sheet }),
    });
    if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    displayResults(data.results);
  } catch (err) {
    setStatus('Search error: ' + err.message);
  }
}

document.getElementById('searchBtn').addEventListener('click', runSearch);
document.getElementById('clearBtn').addEventListener('click', clearResults);
document.getElementById('query').addEventListener('keydown', e => {
  if (e.key === 'Enter') runSearch();
});

window.onload = loadSheets;
</script>

</body>
</html>
