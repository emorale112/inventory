<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Inventory Search</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f6f4fb;
      color: #222;
      padding: 20px;
    }

    h2 {
      color: #5a3e99;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      background-color: #5a3e99;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    #status {
      margin-top: 10px;
      font-size: 1em;
      color: #5a3e99;
    }

    .loader {
      display: none;
      margin: 16px auto;
      border: 4px solid #e0d6ff;
      border-top: 4px solid #5a3e99;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
      display: none;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 0.95em;
    }

    th {
      background-color: #5a3e99;
      color: white;
      text-align: left;
    }

    tr:nth-child(even) {
      background-color: #f2f0fa;
    }
  </style>
</head>
<body>
  <h2>Search Inventory</h2>

  <input type="text" id="query" placeholder="Search term (e.g., Pikachu, 123456)" />
  <select id="column">
    <option value="all">All Columns</option>
    <option value="Item Name">Item Name</option>
    <option value="UPC">UPC</option>
    <option value="Quantity">Quantity</option>
    <option value="Received Date">Received Date</option>
  </select>
  <input type="text" id="sheet" placeholder="Sheet name or 'all'" value="all" />

  <input type="date" id="startDate" />
  <input type="date" id="endDate" />

  <button onclick="runSearch()">Search</button>

  <div class="loader" id="spinner"></div>
  <div id="status">Ready</div>

  <table id="resultsTable">
    <thead>
      <tr>
        <th>Sheet</th>
        <th>Item Name</th>
        <th>UPC</th>
        <th>Quantity</th>
        <th>Received Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxplszX0XuAQKRsutvmzcmU5ACI3nVaE6cwQamXxvZc2d14Ug2uHM3PmrkrJNJBdVj1Bw/exec'; // Replace with your full deployed Apps Script URL

    function runSearch() {
      const query = document.getElementById('query').value.trim();
      const column = document.getElementById('column').value;
      const sheet = document.getElementById('sheet').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      if (!query) {
        document.getElementById('status').textContent = 'Please enter a search term.';
        return;
      }

      document.getElementById('spinner').style.display = 'block';
      document.getElementById('status').textContent = 'Searching...';

      const url = `${webAppUrl}?query=${encodeURIComponent(query)}&column=${encodeURIComponent(column)}&sheet=${encodeURIComponent(sheet)}&startDate=${startDate}&endDate=${endDate}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          document.getElementById('spinner').style.display = 'none';
          const status = document.getElementById('status');
          const table = document.getElementById('resultsTable');
          const tbody = table.querySelector('tbody');
          tbody.innerHTML = '';

          if (data.success && data.results.length) {
            status.textContent = `✅ Found ${data.count} matching row(s).`;
            data.results.forEach(row => {
              const tr = document.createElement('tr');
              row.forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                tr.appendChild(td);
              });
              tbody.appendChild(tr);
            });
            table.style.display = 'table';
          } else {
            status.textContent = 'No results found.';
            table.style.display = 'none';
          }
        })
        .catch(err => {
          document.getElementById('spinner').style.display = 'none';
          document.getElementById('status').textContent = '⚠️ Error: ' + err.message;
        });
    }

    // Allow pressing Enter in search box
    document.getElementById('query').addEventListener('keydown', e => {
      if (e.key === 'Enter') runSearch();
    });
  </script>
</body>
</html>

